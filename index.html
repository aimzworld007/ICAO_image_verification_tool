<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>UAE Emirates ID Photo Tool | One-Click Professional Photos</title>
    <meta name="description" content="Generate a 100% ICAO-compliant professional ID photo with one click. AI-powered tool adds a suit, retouches, and ensures perfect standards for Emirates ID, visa, and passports.">
    <meta name="keywords" content="professional photo generator, Emirates ID photo, ICAO compliance, AI photo editor, one-click photo, add suit to photo, document photo, UAE visa">
    <meta name="author" content="Aimzit">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js" defer></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; transition: background-color 0.3s ease; color: #0f172a;}
        .dark body { background-color: #020617; color: #e2e8f0; }
        .loader { border: 5px solid #e2e8f0; border-top: 5px solid #2563eb; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none !important; }
        .main-card { background-color: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); }
        .dark .main-card { background-color: #0f172a; border: 1px solid #1e293b; }
        .tab { cursor: pointer; padding: 0.75rem 1rem; font-weight: 600; color: #475569; border-bottom: 3px solid transparent; transition: all 0.2s; position: relative; top: 1px; white-space: nowrap; flex-shrink: 0; }
        .dark .tab { color: #94a3b8; }
        .tab.active { color: #2563eb; border-bottom-color: #2563eb; }
        .dark .tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        .btn { background-color: #2563eb; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; text-align: center; display: inline-flex; align-items: center; justify-content: center; border: none; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        .btn:hover:not(:disabled) { transform: translateY(-2px); background-color: #1d4ed8; box-shadow: 0 7px 10px rgba(37, 99, 235, 0.3); }
        .btn:disabled { background-color: #94a3b8; cursor: not-allowed; opacity: 0.7; }
        .file-input-label { border: 2px dashed #cbd5e1; padding: 2rem; text-align: center; cursor: pointer; border-radius: 0.5rem; transition: background-color 0.2s, border-color 0.2s; }
        .dark .file-input-label { border-color: #334155; }
        .file-input-label:hover, .drag-over { background-color: #eff6ff; border-color: #2563eb; }
        .dark .file-input-label:hover, .dark .drag-over { background-color: #1e293b; border-color: #3b82f6; }
        .tab-panel { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #1e293b; color: white; padding: 1rem 1.5rem; border-radius: 0.5rem; box-shadow: 0 10px 15px rgba(0,0,0,0.2); transition: bottom 0.5s ease-in-out; z-index: 100; text-align: center; }
        #toast.show { bottom: 30px; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .dark select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23d1d5db'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E"); }
    </style>
</head>
<body class="dark:bg-slate-900">

    <div id="loader-overlay" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex-col items-center justify-center">
        <div class="loader"></div>
        <p id="loader-text" class="text-white text-lg ml-4 font-semibold mt-4">Processing...</p>
    </div>
    
    <div id="toast"></div>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="relative text-center mb-10">
            <div class="absolute top-0 right-0">
                 <button id="dark-mode-toggle" class="p-2 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300">
                    <span id="sun-icon">‚òÄÔ∏è</span><span id="moon-icon" class="hidden">üåô</span>
                </button>
            </div>
            <div class="inline-block bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md mb-4">
               <svg class="w-12 h-12 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.375a9.375 9.375 0 1 0 0-18.75 9.375 9.375 0 0 0 0 18.75ZM12 18.375a9.375 9.375 0 0 0 7.466-3.722.25.25 0 0 0-.184-.41h-2.562a.25.25 0 0 1-.249-.215 4.375 4.375 0 0 0-8.62-1.34.25.25 0 0 1-.25.215H4.718a.25.25 0 0 0-.184.41A9.375 9.375 0 0 0 12 18.375Z" /></svg>
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold">One-Click Professional ID Photo</h1>
            <p class="text-lg text-slate-600 dark:text-slate-400 mt-2 max-w-3xl mx-auto">Upload any photo. Our AI generates a 100% compliant, studio-quality ID photo for you.</p>
        </header>

        <div class="main-card">
            <div class="border-b border-slate-200 dark:border-slate-700">
                <nav class="tabs-container -mb-px flex space-x-1 md:space-x-4 px-2 md:px-6 justify-center" id="tab-nav">
                    <button class="tab active" data-tab="ai-studio">One-Click Pro Photo</button>
                    <button class="tab" data-tab="icao">AI ICAO Check</button>
                </nav>
            </div>

            <div class="p-4 md:p-8" id="tab-content-container">
                 <div id="tab-content-ai-studio" class="tab-panel">
                     <div class="text-center">
                        <div class="grid md:grid-cols-2 gap-8 items-center max-w-4xl mx-auto">
                            <div>
                                <input type="file" id="ai-photo-input" class="hidden" accept="image/*">
                                <label for="ai-photo-input" class="file-input-label block mb-4">
                                    <span class="block text-xl font-bold text-blue-600 dark:text-blue-400">Step 1: Upload Your Photo</span>
                                    <span class="text-sm">or drag & drop it here</span>
                                </label>
                                <div class="relative w-full aspect-[35/45] bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center justify-center overflow-hidden">
                                    <img id="ai-preview" class="hidden object-contain max-w-full max-h-full" alt="AI Photo Preview">
                                    <p id="ai-placeholder" class="text-slate-500 dark:text-slate-400">Input Preview</p>
                                </div>
                            </div>
                            <div>
                                 <div class="space-y-3 mb-4">
                                     <h3 class="text-xl font-bold text-blue-600 dark:text-blue-400">Step 2: Choose Your Style</h3>
                                     <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="suit-color" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Suit Color</label>
                                            <select id="suit-color" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-slate-700 dark:border-slate-600">
                                                <option>Navy Blue</option>
                                                <option>Black</option>
                                                <option>Charcoal Grey</option>
                                            </select>
                                        </div>
                                         <div>
                                            <label for="lighting-style" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Lighting Style</label>
                                            <select id="lighting-style" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-slate-700 dark:border-slate-600">
                                                <option>Soft Lighting</option>
                                                <option>Standard Lighting</option>
                                            </select>
                                        </div>
                                     </div>
                                 </div>
                                 <div class="relative w-full aspect-[35/45] bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center justify-center overflow-hidden">
                                    <img id="ai-output" class="hidden object-contain max-w-full max-h-full" alt="AI Generated Photo">
                                    <p id="ai-output-placeholder" class="text-slate-500 dark:text-slate-400">AI Generated Output</p>
                                </div>
                            </div>
                        </div>
                        <button id="ai-generate-btn" class="btn mt-8 text-lg" disabled>
                            <svg class="w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                            Generate My Professional Photo
                        </button>
                    </div>
                </div>

                 <div id="tab-content-icao" class="tab-panel hidden">
                    <h2 class="text-2xl font-bold mb-4 text-center">AI-Powered ICAO Photo Verification</h2>
                    <div class="grid md:grid-cols-2 gap-8 items-start max-w-4xl mx-auto">
                        <div>
                            <input type="file" id="verify-photo-input" class="hidden" accept="image/*">
                            <label for="verify-photo-input" id="verify-drop-zone" class="file-input-label block mb-4">
                                <span class="font-semibold text-blue-600 dark:text-blue-400">Click to upload</span>
                                <span> or drag & drop</span>
                            </label>
                            <div class="relative w-full aspect-[35/45] bg-slate-100 dark:bg-slate-800 rounded-lg flex items-center justify-center overflow-hidden">
                                <img id="verify-preview" class="hidden object-contain max-w-full max-h-full" alt="Photo Preview">
                                <p id="verify-placeholder" class="text-slate-500 dark:text-slate-400">Photo Preview</p>
                            </div>
                            <button id="verify-btn" class="btn w-full mt-4" disabled>Verify My Photo</button>
                        </div>
                        <div id="verify-results-container" class="hidden mt-10 md:mt-0">
                            <h3 class="text-xl font-bold mb-4">Instant Pass/Fail Report</h3>
                            <div id="verify-results-list" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="output-section" class="mt-10 hidden">
            <h2 class="text-2xl font-bold text-center mb-4">Your Generated Photos</h2>
            <div id="output-container" class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-lg grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
        </div>
    </div>

    <script>
    var faceApiReady = false;

    document.addEventListener('DOMContentLoaded', () => {
        const loader = document.getElementById('loader-overlay'), loaderText = document.getElementById('loader-text');
        
        function checkLibrariesReady(callback) {
            if (typeof faceapi !== 'undefined') {
                if(!faceApiReady) {
                    loaderText.textContent = "Loading AI Models...";
                    loader.classList.remove('hidden');
                    Promise.all([
                        faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights'),
                        faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights'),
                        faceapi.nets.faceExpressionNet.loadFromUri('https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights')
                    ]).then(() => { faceApiReady = true; loader.classList.add('hidden'); callback(); })
                    .catch(err => { console.error("FaceAPI model loading error:", err); toast.show("Could not load AI models."); loader.classList.add('hidden'); });
                } else { callback(); }
            } else { setTimeout(() => checkLibrariesReady(callback), 150); }
        }
        checkLibrariesReady(initializeApp);
    });

    function initializeApp() {
        // --- CONFIG & STATE ---
        const EID_ASPECT_RATIO = 35 / 45;
        let activeFileForAI = null;

        // --- UI & HELPERS ---
        const loader = {
            overlay: document.getElementById('loader-overlay'), text: document.getElementById('loader-text'),
            show: (msg = "Processing...") => { loader.text.textContent = msg; loader.overlay.classList.remove('hidden'); },
            hide: () => loader.overlay.classList.add('hidden')
        };
        const toast = {
            el: document.getElementById('toast'),
            show: (msg) => { toast.el.textContent = msg; toast.el.classList.add('show'); setTimeout(() => toast.el.classList.remove('show'), 3000); }
        };
        const fileToDataURL = (file) => new Promise((res) => { const r = new FileReader(); r.onload = () => res(r.result); r.readAsDataURL(file); });
        const downloadDataURL = (dataURL, filename) => { const a = document.createElement('a'); a.href = dataURL; a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); };
        const addOutput = (dataURL, filename) => {
            const outSec = document.getElementById('output-section'), outCont = document.getElementById('output-container');
            if(!outSec || !outCont) return;
            outSec.classList.remove('hidden');
            const wrap = document.createElement('div');
            wrap.className = 'text-center p-2 bg-slate-50 dark:bg-slate-700/50 rounded-lg';
            const prev = document.createElement('img');
            prev.src = dataURL;
            prev.className = 'w-full h-32 object-contain rounded-md mb-2';
            const nameEl = document.createElement('p'); nameEl.textContent = filename; nameEl.className = 'text-xs break-all font-semibold';
            const dlBtn = document.createElement('button'); dlBtn.textContent = 'Download'; dlBtn.className = 'btn btn-secondary !text-xs !py-1 !px-2 mt-2 w-full'; dlBtn.onclick = () => downloadDataURL(dataURL, filename);
            wrap.append(prev, nameEl, dlBtn); outCont.appendChild(wrap);
            outSec.scrollIntoView({ behavior: 'smooth' });
        };
        const enableDragDrop = (zone, input, callback) => {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(ev => { zone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); });});
            ['dragenter', 'dragover'].forEach(ev => zone.addEventListener(ev, () => zone.classList.add('drag-over')));
            ['dragleave', 'drop'].forEach(ev => zone.addEventListener(ev, () => zone.classList.remove('drag-over')));
            zone.addEventListener('drop', e => { input.files = e.dataTransfer.files; callback({ target: input }); });
        };

        // --- GEMINI API ---
        async function callGeminiAPI(payload) {
             const model = "gemini-2.5-flash-image-preview", url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=`;
             loader.show("Generating AI Photo...");
             try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const err = await response.json(); throw new Error(err.error ? err.error.message : 'Unknown API error'); }
                const result = await response.json();
                if (result.candidates && result.candidates[0].content.parts.find(p => p.inlineData)) {
                    return result.candidates[0].content.parts.find(p => p.inlineData).inlineData;
                }
                throw new Error("No image data in AI response.");
            } catch (error) { console.error("Gemini API Error:", error); toast.show(`AI Error: ${error.message}`); return null; }
            finally { loader.hide(); }
        }
        
        // --- CORE UI & TABS ---
        function setupCoreUI() {
            const darkModeToggle = document.getElementById('dark-mode-toggle'), applyTheme = (theme) => { document.documentElement.classList.toggle('dark', theme === 'dark'); document.getElementById('sun-icon').classList.toggle('hidden', theme === 'dark'); document.getElementById('moon-icon').classList.toggle('hidden', theme !== 'dark'); };
            darkModeToggle.addEventListener('click', () => { const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
            applyTheme(localStorage.getItem('theme') || 'dark');
            document.getElementById('tab-nav').addEventListener('click', (e) => {
                if (e.target.matches('.tab')) { document.querySelector('.tab.active').classList.remove('active'); e.target.classList.add('active'); document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden')); document.getElementById(`tab-content-${e.target.dataset.tab}`).classList.remove('hidden'); }
            });
        }
        
        // --- AI STUDIO ---
        function setupAiStudio() {
            const input = document.getElementById('ai-photo-input'), dropZone = document.querySelector('label[for="ai-photo-input"]'), preview = document.getElementById('ai-preview'), placeholder = document.getElementById('ai-placeholder'), output = document.getElementById('ai-output'), generateBtn = document.getElementById('ai-generate-btn'), suitColorEl = document.getElementById('suit-color'), lightingStyleEl = document.getElementById('lighting-style');
            
            const handleFile = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                activeFileForAI = file;
                preview.src = await fileToDataURL(file);
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');
                generateBtn.disabled = false;
            };
            input.addEventListener('change', handleFile);
            enableDragDrop(dropZone, input, handleFile);

            generateBtn.addEventListener('click', async () => {
                if (!activeFileForAI) return;
                const base64Data = (await fileToDataURL(activeFileForAI)).split(',')[1];
                const suitColor = suitColorEl.value;
                const lightingStyle = lightingStyleEl.value;
                const prompt = `Produce a professional studio-quality ID photograph of a person in a formal coat and tie, with the suit color specified as ${suitColor}. The background must be pure white, uniformly lit, and free from any shadows or gradients. The image must be HD high-resolution, with upscaling applied to achieve maximum clarity and sharpness. The subject‚Äôs face must remain realistic and undistorted. Skin should be smooth and natural, with blemishes, spots, or imperfections removed, while ensuring a bright, natural-looking tone. The retouching must be subtle and professional, avoiding an artificial appearance. The final image must be ICAO standard compliant, suitable for Emirates ID, visas, and passports. Head size, positioning, and cropping must align with biometric requirements. Use a ${lightingStyle} - balanced and slightly softer studio lighting for a natural, polished, and approachable look. The final output must reflect professional studio quality, with natural skin tones, authentic appearance, and upscale resolution for official document use.`;
                const result = await callGeminiAPI({
                     contents: [{ parts: [ { text: prompt }, { inlineData: { mimeType: activeFileForAI.type, data: base64Data } } ] }],
                     generationConfig: { responseModalities: ['IMAGE'] }
                });
                if (result) {
                    const dataUrl = `data:${result.mimeType};base64,${result.data}`;
                    output.src = dataUrl;
                    output.classList.remove('hidden');
                    document.getElementById('ai-output-placeholder').classList.add('hidden');
                    addOutput(dataUrl, 'professional-photo.png');
                }
            });
        }

        // --- ICAO VERIFICATION ---
        function setupIcaoChecker() {
            const input = document.getElementById('verify-photo-input'), dropZone = document.getElementById('verify-drop-zone'), preview = document.getElementById('verify-preview'), placeholder = document.getElementById('verify-placeholder'), verifyBtn = document.getElementById('verify-btn'), resultsContainer = document.getElementById('verify-results-container'), resultsList = document.getElementById('verify-results-list');
            
            const handleFile = (e) => { const file = e.target.files[0]; if (!file) return; preview.src = URL.createObjectURL(file); preview.onload = () => { preview.classList.remove('hidden'); placeholder.classList.add('hidden'); verifyBtn.disabled = false; resultsContainer.classList.add('hidden'); }; };
            input.addEventListener('change', handleFile);
            enableDragDrop(dropZone, input, handleFile);

            verifyBtn.addEventListener('click', async () => {
                if (!faceApiReady) { toast.show("AI models still loading. Please wait a moment."); return; }
                loader.show("Running AI Verification...");
                const detections = await faceapi.detectAllFaces(preview, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions();
                const checks = [];
                checks.push({pass: Math.abs((preview.naturalWidth / preview.naturalHeight) - EID_ASPECT_RATIO) < 0.05, msg: "Incorrect aspect ratio (must be 35x45)."});
                if (detections.length === 1) {
                    const d = detections[0];
                    const headYCenter = d.detection.box.y + d.detection.box.height / 2, imgYCenter = preview.naturalHeight / 2;
                    checks.push({pass: Math.abs(headYCenter - imgYCenter) < (preview.naturalHeight * 0.1), msg: "Head is not centered."});
                    checks.push({pass: d.expressions.neutral > 0.8, msg: "Facial expression is not neutral."});
                } else { checks.push({pass: false, msg: `Found ${detections.length} faces. Only one is allowed.`}); }
                loader.hide();
                resultsList.innerHTML = '';
                let allPassed = true;
                checks.forEach(check => {
                    if (!check.pass) allPassed = false;
                    const item = document.createElement('div');
                    item.className = `flex items-center justify-between p-3 rounded-lg ${check.pass ? 'bg-green-100 dark:bg-green-900/50' : 'bg-red-100 dark:bg-red-900/50'}`;
                    item.innerHTML = `<p class="text-sm ${check.pass ? 'text-green-800 dark:text-green-300' : 'text-red-800 dark:text-red-300'}">${check.pass ? '‚úÖ' : '‚ùå'} ${check.msg}</p>`;
                    resultsList.appendChild(item);
                });
                if (allPassed) {
                     resultsList.innerHTML = `<div class="p-3 rounded-lg bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 font-semibold text-center">‚úÖ All checks passed! Your photo appears to be compliant.</div>`;
                }
                resultsContainer.classList.remove('hidden');
            });
        }
        
        // --- INITIALIZATION ---
        function main() {
            setupCoreUI();
            setupAiStudio();
            setupIcaoChecker();
        }

        main();
    }
    </script>
</body>
</html>


